---
import { clsx } from 'clsx/lite'
import Container from '../elements/container.astro'
import CheckmarkIcon from '../icons/checkmark-icon.astro'
import MinusIcon from '../icons/minus-icon.astro'

const { plans, features, className, ...props } = Astro.props
---

<section class={clsx('py-16', className)} {...props}>
  <Container>
    <table class="w-full border-collapse text-left text-sm/5 max-sm:hidden">
      <colgroup>
        <col class="w-2/5" />
        {plans.map((plan) => (
          <col key={plan} style={`width: calc(60% / ${plans.length})`} />
        ))}
      </colgroup>
      <thead>
        <tr>
          <th class="sticky top-(--scroll-padding-top) bg-mist-100 py-5 pr-3 text-base/7 font-medium text-mist-950 dark:bg-mist-950 dark:text-white">
            Compare features
          </th>
          {plans.map((plan, index) => (
            <th
              key={index}
              class="sticky top-(--scroll-padding-top) bg-mist-100 p-3 text-center font-semibold text-mist-950 dark:bg-mist-950 dark:text-white"
            >
              {plan}
            </th>
          ))}
        </tr>
      </thead>
      {features.map((group, index) => (
        <tbody>
          <tr>
            <th
              colSpan={plans.length + 1}
              scope="colgroup"
              class="border-t border-b border-t-mist-950/5 border-b-mist-950/10 pt-14 pb-4 font-semibold text-mist-950 dark:border-t-white/5 dark:border-b-white/10 dark:text-white"
            >
              {group.title}
            </th>
          </tr>
          {group.features.map((feature) => (
            <tr key={String(feature.name)} class="group">
              <th
                scope="row"
                class="border-t border-mist-950/5 py-4 pr-3 font-normal text-mist-700 group-first:border-mist-950/10 dark:border-white/5 dark:text-mist-400 dark:group-first:border-white/10"
              >
                {feature.name}
              </th>
              {plans.map((plan) => {
                const value = typeof feature.value === 'object' && feature.value !== null && plan in feature.value ? feature.value[plan] : feature.value

                return (
                  <td
                    key={plan}
                    class="border-t border-mist-950/5 px-3 py-4 text-center text-mist-700 group-first:border-mist-950/10 dark:border-white/10 dark:text-mist-400 dark:group-first:border-white/10"
                  >
                    {value === true ? (
                      <CheckmarkIcon aria-label="Included" class="stroke-mist-950 dark:stroke-white" />
                    ) : value === false ? (
                      <MinusIcon aria-label="Not included" class="stroke-mist-950 dark:stroke-white" />
                    ) : (
                      value
                    )}
                  </td>
                )
              })}
            </tr>
          ))}
        </tbody>
      ))}
    </table>

    <div class="sm:hidden">
      <div class="flex gap-6 border-b border-b-mist-950/10 dark:border-b-white/10">
        {plans.map((plan, index) => (
          <button
            key={plan}
            type="button"
            onclick={`document.querySelectorAll('.mobile-plan-content').forEach((el) => el.classList.add('hidden')); document.querySelector('.mobile-plan-content[data-plan="${plan}"]').classList.remove('hidden'); document.querySelectorAll('.mobile-plan-btn').forEach((el) => el.classList.remove('border-b-mist-950', 'text-mist-950', 'dark:border-white', 'dark:text-white')); this.classList.add('border-b-mist-950', 'text-mist-950', 'dark:border-white', 'dark:text-white');`}
            class={`mobile-plan-btn relative -mb-px flex-1 border-b border-b-transparent px-2 py-6 text-sm/5 font-medium text-mist-500 dark:text-mist-500 ${index === 0 ? 'border-b-mist-950 text-mist-950 dark:border-white dark:text-white' : ''}`}
          >
            {plan}
          </button>
        ))}
      </div>
      {plans.map((plan) => (
        <div key={plan} class={`mobile-plan-content ${plan !== plans[0] ? 'hidden' : ''}`} data-plan={plan}>
          <table class="w-full border-collapse text-left text-sm/5">
            <colgroup>
              <col class="w-3/4" />
              <col class="w-1/4" />
            </colgroup>
            {features.map((group, index) => (
              <tbody>
                <tr>
                  <th
                    colSpan={2}
                    scope="colgroup"
                    class="border-t border-b border-t-mist-950/5 border-b-mist-950/10 pt-14 pb-4 font-semibold text-mist-950 dark:border-t-white/5 dark:border-b-white/10 dark:text-white"
                  >
                    {group.title}
                  </th>
                </tr>
                {group.features.map((feature) => (
                  <tr key={String(feature.name)} class="group">
                    <th
                      scope="row"
                      class="border-t border-mist-950/5 py-4 pr-3 font-normal text-mist-700 group-first:border-mist-950/10 dark:border-white/5 dark:text-mist-400 dark:group-first:border-white/10"
                    >
                      {feature.name}
                    </th>
                    <td
                      class="border-t border-mist-950/5 px-3 py-4 text-center text-mist-700 group-first:border-mist-950/10 dark:border-white/10 dark:text-mist-400 dark:group-first:border-white/10"
                    >
                      {(() => {
                        const value = typeof feature.value === 'object' && feature.value !== null && plan in feature.value ? feature.value[plan] : feature.value
                        return value === true ? (
                          <CheckmarkIcon aria-label="Included" class="stroke-mist-950 dark:stroke-white" />
                        ) : value === false ? (
                          <MinusIcon aria-label="Not included" class="stroke-mist-950 dark:stroke-white" />
                        ) : (
                          value
                        )
                      })()}
                    </td>
                  </tr>
                ))}
              </tbody>
            ))}
          </table>
        </div>
      ))}
    </div>
  </Container>
</section>